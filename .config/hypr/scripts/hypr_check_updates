#!/bin/bash

# Function to check for updates and generate notification if updates are available
check_updates() {
    # Change to the dotfiles directory
    cd "$HOME/Hyprland-blizz" || { echo "Failed to change to dotfiles directory." >&2; exit 1; }

    # Fetch the latest changes from the remote repository
    git fetch origin main

    # Compare the local branch with the remote repository
    local commits_behind=$(git rev-list --count HEAD..origin/main)
    if [ "$commits_behind" -gt 0 ]; then
        # Updates are available
        send_notification "Updates are available for the dotfiles repository. Run the Hyprland welcome app to apply updates." "critical"
        return 0
    else
        # No updates available
        return 1
    fi
}

# Function to send a notification using dunst
send_notification() {
    local message="$1"
    local urgency="$2"
    dunstify -p "$urgency" -u "$urgency" "$message"
}

# Loop to check for updates and send reminders until updates are applied
while true; do
    if check_updates; then
        echo "Updates are available for the dotfiles repository."
        # Wait for an hour before checking again
        sleep 3600  # 3600 seconds = 1 hour
    else
        echo "No updates available for the dotfiles repository."
        break  # Exit the loop if no updates are available
    fi
done

# Change to the scripts directory
cd "$HOME/.config/hypr/scripts" || { echo "Failed to change to the scripts directory." >&2; exit 1; }

# Create symlink in /usr/bin for easy access
ln -s "$(pwd)/hypr_check_updates.sh" /usr/bin/hypr_check_updates >/dev/null 2>&1
